---
title: "Principal Components Analysis (PCA)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Principal Components Analysis (PCA)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(Rubrary)
library(dplyr)
```

# Data

`palmerpenguins` dataset from Allison Horst

```{r Get palmerpenguins data, message=FALSE}
if (!requireNamespace("palmerpenguins", quietly = TRUE)){
  install.packages("palmerpenguins")
}
library(palmerpenguins)

names(penguins)
data("penguins")
penguins <- penguins %>%
  as.data.frame() %>%
  mutate(Sample_ID = paste0(penguins_raw$`Individual ID`, "_", penguins_raw$`Sample Number`))
  
rownames(penguins) <- penguins$Sample_ID
```

```{r Run PCA}
num <- penguins %>%
  select(!c(species, island, sex, year, Sample_ID)) %>%
  t() %>%
  as.data.frame() %>%
  select(where(~!all(is.na(.x))))
  
pca <- Rubrary::run_PCA(
  df = num,
  summary = T, tol = 0,
  center = T, scale = T,
  screeplot = T
)
```


```{r Plot PCA}
Rubrary::plot_PCA(
  df_pca = pca,
  anno = penguins,
  annoname = "Sample_ID",
  annotype = "species",
  title = "Palmer Penguins PCA Scores - Species",
  label = FALSE
)
```

